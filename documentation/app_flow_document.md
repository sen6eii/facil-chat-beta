# App Flow Document for FácilChat

## Onboarding and Sign-In/Sign-Up

When a new user opens the application at the root URL, they arrive on a Spanish-language landing page displaying the FácilChat logo, a brief tagline about centralizing WhatsApp conversations, and a prominent button labeled “Iniciar sesión con Google.” If the user is not yet authenticated, clicking this button triggers the Google Sign-In flow powered by Supabase Auth. Once the user grants permission and the login succeeds, they are assigned the role of “Administrador del negocio” and immediately redirected to the dashboard at `/dashboard`. If the user is already signed in from a previous session when arriving at the root URL or at `/auth/login`, the application detects the active session and bypasses the login screen, sending them straight to the dashboard. There is no traditional email/password form because authentication relies exclusively on Google Sign-In. To sign out, the user clicks the “Cerrar sesión” link in the sidebar menu, which clears their session and returns them to the login page. Since password recovery is not applicable to Google OAuth, there is no reset password flow.

## Main Dashboard or Home Page

After sign-in, the user lands on the main dashboard at `/dashboard`, which is the central hub of FácilChat. The page header shows the FácilChat logo on the left and a user avatar with the “Cerrar sesión” option on the right. A vertical sidebar on the left lists the main navigation links labeled in Spanish: “Dashboard,” “Clientes,” “Etiquetas,” “Mensajes,” “FAQs,” and “Ajustes.” The central area displays four numeric metric cards that show the total number of clients, the count of active chats in real time, the response rate over the last thirty days within two hours, and the number of new clients this month. Below the cards, a scrolling list titled “Actividad reciente” surfaces the five most recent messages received. Positioned above the metrics, a visible onboarding component guides the user through three steps if they have not completed setup. Once these steps are done or skipped, the component hides automatically.

## Detailed Feature Flows and Page Transitions

In the “Clientes” section at `/clients`, users see a table of all active clients with columns for name, phone number in E.164 format (+598 prefix), last message snippet, assigned labels, and status. A button labeled “Agregar cliente” opens a modal form where the user enters the client’s name and phone, then saves to create a new client. Clicking the edit icon on a row opens the same form populated with existing data, allowing updates or archiving. Archiving moves the client out of the active list but retains the record. From this page, users can filter clients by manual or automatic labels using a search field, and can click on any client row to view more details or simply manage labels inline.

The “Etiquetas” page at `/labels` shows two sections side by side. The active labels panel lists manual and automatic tags with their names and types. A button labeled “Crear etiqueta” reveals a form at the top where users specify a label name and choose manual type. Saving adds it to the active list. If a label has no clients associated, the system marks it inactive and moves it to the archived section below. The archived section displays those labels with an “Restaurar” link to reactivate or a “Eliminar” option to remove it entirely.

In the “Mensajes” area at `/messages`, the user finds two lists titled “Sin responder” and “Recientes.” Each message entry shows the client name, a preview of the message, and a timestamp. Next to each entry is a button labeled “Responder en WhatsApp,” which opens a new browser tab to `https://wa.me/<number>` using the client’s E.164 number. This transition takes the user out of FácilChat into WhatsApp Web for the actual conversation. Returning to FácilChat, the message list refreshes to reflect that the chat is no longer unreplied.

The “FAQs” section at `/faqs` features a table of question–answer pairs for auto-responses. A button labeled “Agregar FAQ” reveals a form where the user types a question and the matching automated answer. Saving the FAQ stores it in the database. There is also an input area to customize the fallback message that is sent when no FAQ matches, as well as a field to edit the welcome message for new contacts. Editing or deleting an FAQ is done inline via action links on each row.

When an incoming message arrives via Twilio’s webhook at `/api/twilio/webhook`, the backend stores it in the `messages` table and checks for a matching FAQ by exact text match. If a match exists, the system immediately sends the predefined response through the Twilio API. If not, the fallback message is sent. Once the message is processed, a Supabase Realtime event updates the message tables and dashboard metrics.

## Settings and Account Management

Under the “Ajustes” link at `/settings`, the user manages the business profile and integration credentials. The top of the page features a form to upload a logo image and set the business name. This uses Supabase Storage for the file and saves the URL in the user’s profile record. Below, fields for the Twilio Account SID, Auth Token, and global WhatsApp number appear, all masked for security. Beneath these inputs, the application displays the webhook URL, which users can copy with one click to configure their Twilio console. Saving the form updates environment variables in the backend. Returning to the dashboard is as simple as clicking “Dashboard” in the sidebar.

## Error States and Alternate Paths

If the user enters a phone number without the +598 prefix or in an invalid format when adding or editing a client, the form shows a Spanish error message under the field and prevents submission until corrected. When saving Twilio credentials fails due to invalid keys, the settings form displays an error banner explaining that the credentials could not be verified. If the Supabase Realtime connection drops, a non-blocking banner appears at the top of the dashboard warning that live updates are paused, and metrics will refresh once connectivity is restored. In the onboarding component, if the user chooses to skip, the panel hides but a link labeled “Ver guía de inicio” stays at the bottom of the sidebar so they can reopen the onboarding flow at any time. If a webhook event is malformed or Twilio is unreachable, the backend logs the error and retries up to three times; a server-side alert can notify the administrator of failed webhooks for manual review.

## Conclusion and Overall App Journey

From the first moment the user clicks “Iniciar sesión con Google,” they are guided through a simple onboarding that connects their WhatsApp Business number, sets up FAQs, and leads them to a clear dashboard. There, real-time metrics and recent messages keep them informed at a glance. Managing clients and labels happens in dedicated pages with inline forms and modals, while responding to chats always redirects them to WhatsApp Web via a single button click. Settings let them brand the app and configure Twilio in one place. Throughout the journey, error messages and fallback options ensure they never get stuck. At any time, the user can sign out securely and return later to pick up right where they left off.
